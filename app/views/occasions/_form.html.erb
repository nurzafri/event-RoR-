<%= form_for(@occasion, html: {autocomplete: 'off', class: 'col l12'}) do |f| %> 
  <% if @occasion.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@occasion.errors.count, "error") %> prohibited this occasion from being saved:</h2>

      <ul>
      <% @occasion.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

    <div class="row">
    <div class="input-field col l6">
      <%= f.text_field :name, autocomplete: 'off', class: 'validate' %>
      <%= f.label :name %>
    </div>
  </div>

      <div class="row">
    <div class="input-field col l6">
      <%= f.text_field :description, autocomplete: 'off', class: 'validate' %>
      <%= f.label :description %>
    </div>
  </div>

      <div class="row">
    <div class="input-field col l6">
      <%= f.text_field :venue, autocomplete: 'off', class: 'validate' %>
      <%= f.label :venue %>
    </div>
  </div>

  <div class="row">
    <div class="input-field col l6 datetime">
      <%= f.label :date %><br>
      <%= f.datetime_select :date %>
    </div>
  </div>

    <%= f.text_field :latitude, hidden: false %>
    <%= f.text_field :longitude, hidden: false %>
  
  <div class="row">
    <div class="col l6">
      <%= f.submit class: "btn waves-effect" %>
    </div>
  </div>

<!--<style type="text/css">
        .placepicker-map {
        width: 100%;
        height: 300px;
      }
</style> -->

<!-- <div id="collapseOne" class="collapse">
  <div class="placepicker-map thumbnail"></div>
</div> -->

    <style>
      #map {
        width: 500px;
        height: 400px;
      }
    </style>

<div id="map"></div>

<% end %>
<!-- <div id="us2" style="width: 500px; height: 400px;"></div> -->
    <script>
      var map;
      var marker;
      var user_lat;
      var user_long;
      var userLatLong;
      // var contentString;

      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(showPosition);
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      }

      function showPosition(position){
        user_lat =  position.coords.latitude;
        user_long = position.coords.longitude;
        userLatLong = {lat: user_lat, lng: user_long};
        initMap();
      }

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: userLatLong
        });

        marker = new google.maps.Marker({
          position: userLatLong,
          map: map,
          draggable: true,
          title: 'You are Here'
        });

        var infowindow = new google.maps.InfoWindow({
          content: "<p>UNIVERSITI ISLAM</p>"+"<p>ANTARABANGSA MALAYSIA</p>",
        });

        marker.addListener('click', function() {
        infowindow.open(map, marker);
        });

        marker.addListener('dragend', function(e) {
        console.log("Latitude: " + e.latLng.lat() + "\r\nLongitude: " + e.latLng.lng());
        updateLatLng(e.latLng);
        });

        google.maps.event.addListener(map, 'click', function (e) {
                console.log("Latitude: " + e.latLng.lat() + "\r\nLongitude: " + e.latLng.lng());
                placeMarker(e.latLng);
                updateLatLng(e.latLng);

            });

        function placeMarker(location) {
          marker.setPosition(location);
        }


        // map.addListener('click', function(e) {
        //   console.log(e.getPosition())
        // });
      }

      function updateLatLng(latLng){
        $('#occasion_latitude').val(latLng.lat());
        $('#occasion_longitude').val(latLng.lng());
      }

      getLocation();

      // $('#occasion_latitude').val(user_lat)
      // $('#occasion_longitude').val(user_long)

      //   console.log(position)

        // $('#us2').locationpicker({
        //   location: {latitude: user_lat, longitude: user_long}, 
        //   radius: 20,
        //   inputBinding: {
            // latitudeInput: $('#occasion_latitude'),
            // longitudeInput: $('#occasion_longitude'),
            // locationNameInput: $('#occasion_venue')
          // }
        // });
      // }
      // getLocation();      

    // var map;
    // $(".placepicker").placepicker({
    // placeChanged: function(place) {
    //   $('#occasion_latitude').val(this.getLocation().latitude)
    //   $('#occasion_longitude').val(this.getLocation().longitude)
    //   $('#occasion_venue').val(place.formatted_address)
    // }
  // });
  
    </script>